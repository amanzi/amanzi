name: Amanzi CI

on: [push]

env:
    AMANZI_TPLS_VER: 0.97.12

jobs:
  build_test:
    runs-on: ubuntu-latest
    name: Build and test with Docker
    steps:
    - name: Check out the Amanzi repo
      uses: actions/checkout@v2   
    - name: Get TPLs version
      id: version
      working-directory: Docker
      echo "::set-output name=AMANZI_TPLS_VER=::$(./get_tpls_version.sh)"
    - name: Docker build
      id: docker
      working-directory: Docker
      run: docker build --build-arg amanzi_tpls_ver=${steps.version.outputs.AMANZI_TPLS_VER} -t metsi/amanzi:latest -f Dockerfile-Amanzi .
